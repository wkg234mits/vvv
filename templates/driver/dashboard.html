{% extends "base.html" %}
{% block content %}
<div class="container-fluid">
    <h2 class="mb-4">Tableau de Bord Chauffeur</h2>

    <!-- Informations principales -->
    <div class="row g-4 mb-4">
        <!-- Camion assignÃ© -->
        <div class="col-md-3">
            <div class="card p-3">
                <h5>Camion AssignÃ©</h5>
                <div class="d-flex align-items-center mt-2">
                    <div class="flex-grow-1">
                        <h4 class="mb-0">{{ current_task.truck.matricule if current_task else 'Aucun' }}</h4>
                        <small>{{ current_task.truck.model if current_task }}</small>
                    </div>
                    <div class="fs-1">ðŸšš</div>
                </div>
            </div>
        </div>

        <!-- Lieu de dÃ©part -->
        <div class="col-md-3">
            <div class="card p-3">
                <h5>Lieu de DÃ©part</h5>
                <div class="mt-3">
                    <p class="fs-5 mb-0">{{ current_task.lieu_depart if current_task else 'N/A' }}</p>
                </div>
            </div>
        </div>

        <!-- Lieu d'arrivÃ©e -->
        <div class="col-md-3">
            <div class="card p-3">
                <h5>Lieu d'ArrivÃ©e</h5>
                <div class="mt-3">
                    <p class="fs-5 mb-0">{{ current_task.lieu_arrivee if current_task else 'N/A' }}</p>
                </div>
            </div>
        </div>

        <!-- Niveau de carburant -->
        <div class="col-md-3">
            <div class="card p-3">
                <h5>Niveau de Carburant</h5>
                <div class="fuel-gauge mt-3">
                    <div class="gauge-circle" data-percent="{{ current_task.truck.fuel_level if current_task else 0 }}">
                        <div class="inner-circle"></div>
                        <span class="percent-text">{{ current_task.truck.fuel_level if current_task else 0 }}%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statut de la mission -->
        <div class="col-md-12">
            <div class="card p-3 mt-4">
                <h5>Statut de Mission</h5>
                <div class="mission-status mt-3">
                    {% if current_task %}
                        <span class="badge bg-{{ 'success' if current_task.status == 'TerminÃ©' else 'warning' }} fs-6 p-2">
                            {{ current_task.status }}
                        </span>
                        <div class="mt-3">
                            <small>DÃ©but: {{ current_task.start_date.strftime('%d/%m %H:%M') }}</small><br>
                            <small>Fin: {{ current_task.end_date.strftime('%d/%m %H:%M') }}</small>
                        </div>
                    {% else %}
                        <p class="text-muted mt-2">Aucune mission active</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    {% if fuel_history_labels and fuel_history_data %}
<script>
    const fuelCtx = document.getElementById('fuelHistoryChart').getContext('2d');
    new Chart(fuelCtx, {
        type: 'line',
        data: {
            labels: {{ fuel_history_labels | tojson }},
            datasets: [{
                label: 'Niveau de carburant',
                data: {{ fuel_history_data | tojson }},
                borderColor: '#2ecc71',
                fill: false,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: true },
                title: {
                    display: true,
                    text: 'Ã‰volution du carburant'
                }
            },
            scales: {
                y: {
                    min: 0,
                    max: 100,
                    title: {
                        display: true,
                        text: 'Pourcentage (%)'
                    }
                }
            }
        }
    });
</script>
{% endif %}

    // Animation jauge de carburant
    document.querySelectorAll('.gauge-circle').forEach(gauge => {
        const percent = gauge.getAttribute('data-percent');
        gauge.style.background = `conic-gradient(#2ecc71 ${percent}%, #34495e ${percent}% 100%)`;
    });
</script>

<!-- Styles jauge -->
<style>
.fuel-gauge {
    display: flex;
    justify-content: center;
    align-items: center;
}
.gauge-circle {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    background: conic-gradient(#2ecc71 0%, #34495e 0% 100%);
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}
.inner-circle {
    width: 60px;
    height: 60px;
    background: white;
    border-radius: 50%;
    z-index: 1;
}
.percent-text {
    position: absolute;
    font-weight: bold;
}
</style>
{% endblock %}
